#!/usr/bin/env python3
"""
Git pre-commit hook - runs verify_before_push.py checks automatically.
Install: copy to .git/hooks/pre-commit (or use setup_hooks.py)
"""

import subprocess
import sys
import os
import shutil

# Change to repo root (parent of .git/hooks/)
repo_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
os.chdir(repo_root)

# Find a working Python: prefer sys.executable, fallback to PATH search
python_exe = sys.executable
if not python_exe or not os.path.isfile(python_exe):
    python_exe = shutil.which("python3") or shutil.which("python")
if not python_exe:
    print("[pre-commit] WARNING: Could not find Python interpreter, skipping checks")
    sys.exit(0)

result = subprocess.run(
    [python_exe, "verify_before_push.py"],
    capture_output=True,
    text=True,
)

# Print output so user sees it
if result.stdout:
    print(result.stdout, end="")
if result.stderr:
    print(result.stderr, end="", file=sys.stderr)

sys.exit(result.returncode)
